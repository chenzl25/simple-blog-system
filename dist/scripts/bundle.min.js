var phonecatAnimations=angular.module("phonecatAnimations",["ngAnimate"]);phonecatAnimations.animation(".phone",function(){var e=function(e,t,s){return"active"==t?(e.css({position:"absolute",top:500,left:0,display:"block"}),jQuery(e).animate({top:0},s),function(t){t&&e.stop()}):void 0},t=function(e,t,s){return"active"==t?(e.css({position:"absolute",left:0,top:0}),jQuery(e).animate({top:-500},s),function(t){t&&e.stop()}):void 0};return{addClass:e,removeClass:t}});var blogApp=angular.module("blogApp",["ngRoute","blogControllers"]);blogApp.config(["$routeProvider",function(e){e.when("/login",{templateUrl:"./partials/login.html",controller:"loginCtrl"}).when("/register",{templateUrl:"./partials/register.html",controller:"registerCtrl"}).when("/user",{templateUrl:"./partials/user.html",controller:"userCtrl"}).when("/home",{templateUrl:"./partials/home.html",controller:"homeCtrl"}).when("/user/:postId",{templateUrl:"./partials/user-post-detail.html",controller:"userPostDetailCtrl"}).when("/home/:postId",{templateUrl:"./partials/home-post-detail.html",controller:"homePostDetailCtrl"}).otherwise({redirectTo:"/login"})}]);var blogControllers=angular.module("blogControllers",["blogServices"]);blogControllers.controller("loginCtrl",["$scope","$rootScope","$http","validator","$location",function(e,t,s,a,o){e.message="",e.messageClass="",e.account="",e.password="",e.login=function(){var r=a.validateLogin({account:e.account,password:e.password});r?(e.messageClass="warning",e.message=r):s.post("/proxy/api/login",{account:e.account,password:e.password}).success(function(s){s.error?(e.messageClass="warning",e.message=s.message):(e.messageClass="success",e.message="",t.userData=s.userData,o.url("/user"))})}}]),blogControllers.controller("registerCtrl",["$scope","$http","validator",function(e,t,s){e.message="",e.messageClass="",e.account="",e.password="",e.again="",e.name="",e.register=function(){var a=s.validateRegister({account:e.account,password:e.password,name:e.name});e.password!==e.again&&(a+="两次输入密码不相同\n"),a?(e.messageClass="warning",e.message=a):t.post("/proxy/api/register",{account:e.account,password:e.password,name:e.name}).success(function(t){alert(t.message,t.error),t.error?(e.messageClass="warning",e.message=t.message):(e.messageClass="success",e.message=t.message)})}}]),blogControllers.controller("userCtrl",["$scope","$http","validator","$rootScope","$location",function(e,t,s,a,o){t.post("/proxy/api/login",{account:"14331048",password:"14331048"}).success(function(e){a.userData=e.userData}),e.enterPostDetail=function(e){a.postData=e,o.url("/user/"+e._id)},e.title="",e.content="",e.message="",e.messageClass="",e.createPost=function(){console.log(e.message.length);var o=s.validatePost({title:e.title,content:e.content});o?(e.messageClass="warning",e.message=o):t.post("/proxy/api/post",{title:e.title,content:e.content}).success(function(t){t.error?(e.messageClass="warning",e.message=t.message):(e.messageClass="success",e.message="",a.userData.posts.unshift(t.postData))})}}]),blogControllers.controller("userPostDetailCtrl",["$scope","$http","validator","$rootScope","$location","$routeParams",function(e,t,s,a,o,r){t.get("/proxy/api/posts").success(function(e){a.postsData=e.postsData,a.postData=e.postsData[2]}),e.content="",e.createComment=function(){var o=s.validateComment({content:e.content});o?(e.messageClass="warning",e.message=o):t.post("/proxy/api/post/"+r.postId+"/comment",{title:e.title,content:e.content}).success(function(t){t.error?(e.messageClass="warning",e.message=t.message):(e.messageClass="success",e.message="",a.postData.comments.push(t.commentData))})},e.editState=!1,e.messageClass="",e.message="",e.editStateHandler=function(){e.editState=!e.editState},e.editPost=function(){var o=s.validatePost({title:a.postData.title,content:a.postData.content});o?(e.messageClass="warning",e.message=o):t.put("/proxy/api/post/"+r.postId,{title:e.postData.title,content:e.postData.content}).success(function(t){t.error?(e.messageClass="warning",e.message=t.message):(e.messageClass="success",e.message="",e.editState=!1,a.postData=t.postData)})}}]),blogControllers.controller("homeCtrl",["$scope","$http","validator","$rootScope","$location",function(e,t,s,a,o){t.get("/proxy/api/posts").success(function(e){a.postsData=e.postsData}),e.enterPostDetail=function(e){a.postData=e,o.url("/home/"+e._id)}}]),blogControllers.controller("homePostDetailCtrl",["$scope","$http","validator","$rootScope","$location","$routeParams",function(e,t,s,a,o,r){t.get("/proxy/api/posts").success(function(e){a.postsData=e.postsData,a.postData=e.postsData[2]}),e.content="",e.createComment=function(){var o=s.validateComment({content:e.content});o?(e.messageClass="warning",e.message=o):t.post("/proxy/api/post/"+r.postId+"/comment",{title:e.title,content:e.content}).success(function(t){t.error?(e.messageClass="warning",e.message=t.message):(e.messageClass="success",e.message="",a.postData.comments.push(t.commentData))})}}]),angular.module("phonecatFilters",[]).filter("checkmark",function(){return function(e){return e?"✓":"✘"}});var blogServices=angular.module("blogServices",["ngResource"]);blogServices.factory("Blog",["$resource",function(e){return e("api/post/:postId",{},{query:{method:"GET",params:{phoneId:"posts"},isArray:!0}})}]),blogServices.factory("validator",function(){var e={beChecked:{userAccount:{errorMessage:"用户名6~18位英文字母、数字",emptyMessage:"账号为空",pattern:/^[a-zA-Z0-9]{6,18}$/},userPassword:{errorMessage:"密码6~18位英文字母、数字",emptyMessage:"密码为空",pattern:/^[a-zA-Z0-9]{6,18}$/},userName:{errorMessage:"名字长度为2-20个字符",emptyMessage:"名字为空",pattern:/^.{2,20}$/},postTitle:{errorMessage:"blog标题长度为2-50个字符",emptyMessage:"blog标题为空",pattern:/^.{2,50}$/},postContent:{errorMessage:"blog内容长度为2-10000个字符",emptyMessage:"blog内容为空",pattern:/.{2,10000}/},commentContent:{errorMessage:"评论长度为2-2000个字符",emptyMessage:"评论内容为空",pattern:/.{2,2000}/}},_validate:function(e){var t="";for(var s in e)e[s]?this.beChecked[s].pattern.test(e[s])||(t+=this.beChecked[s].errorMessage+"\n"):t+=this.beChecked[s].emptyMessage+"\n";return t},validateRegister:function(e){return this._validate({userAccount:e.account,userPassword:e.password,userName:e.name})},validateLogin:function(e){return this._validate({userAccount:e.account,userPassword:e.password})},validatePost:function(e){return this._validate({postTitle:e.title,postContent:e.content})},validateComment:function(e){return this._validate({commentContent:e.content})}};return e});var validator={beChecked:{userAccount:{errorMessage:"用户名6~18位英文字母、数字",emptyMessage:"账号为空",pattern:/^[a-zA-Z0-9]{6,18}$/},userPassword:{errorMessage:"密码6~18位英文字母、数字",emptyMessage:"密码为空",pattern:/^[a-zA-Z0-9]{6,18}$/},userName:{errorMessage:"名字长度为2-20个字符",emptyMessage:"名字为空",pattern:/^.{2,20}$/},postTitle:{errorMessage:"blog标题长度为2-50个字符",emptyMessage:"blog标题为空",pattern:/^.{2,50}$/},postContent:{errorMessage:"blog内容长度为2-10000个字符",emptyMessage:"blog内容为空",pattern:/^.{2,10000}$/},commentContent:{errorMessage:"评论长度为2-2000个字符",emptyMessage:"评论内容为空",pattern:/^.{2,2000}$/}},_validate:function(e){var t="";for(var s in e)e[s]?this.beChecked[s].pattern.test(e[s])||(t+=this.beChecked[s].errorMessage+"\n"):t+=this.beChecked[s].emptyMessage+"\n";return t},validateRegister:function(e){return this._validate({userAccount:e.account,userPassword:e.password,userName:e.name})},validateLogin:function(e){return this._validate({userAccount:e.account,userPassword:e.password})},validatePost:function(e){return this._validate({postTitle:e.title,postContent:e.content})},validateComment:function(e){return this._validate({commentContent:e.content})}};module.exports=validator;