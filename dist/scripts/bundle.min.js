var phonecatAnimations=angular.module("phonecatAnimations",["ngAnimate"]);phonecatAnimations.animation(".phone",function(){var e=function(e,t,s){return"active"==t?(e.css({position:"absolute",top:500,left:0,display:"block"}),jQuery(e).animate({top:0},s),function(t){t&&e.stop()}):void 0},t=function(e,t,s){return"active"==t?(e.css({position:"absolute",left:0,top:0}),jQuery(e).animate({top:-500},s),function(t){t&&e.stop()}):void 0};return{addClass:e,removeClass:t}});var blogApp=angular.module("blogApp",["ngRoute","blogControllers","blogServices","ngAnimate"]);blogApp.config(["$routeProvider",function(e){e.when("/login",{templateUrl:"./partials/login.html",controller:"loginCtrl"}).when("/register",{templateUrl:"./partials/register.html",controller:"registerCtrl"}).when("/user",{templateUrl:"./partials/user.html",controller:"userCtrl"}).when("/home/page/:page",{templateUrl:"./partials/home.html",controller:"homeCtrl"}).when("/user/post/:postId",{templateUrl:"./partials/user-post-detail.html",controller:"userPostDetailCtrl"}).when("/home/post/:postId",{templateUrl:"./partials/home-post-detail.html",controller:"homePostDetailCtrl"}).when("/manager",{templateUrl:"./partials/manager.html",controller:"managerCtrl"}).when("/manager/post/:postId",{templateUrl:"./partials/manager-post-detail.html",controller:"managerPostDetailCtrl"}).otherwise({redirectTo:"/login"})}]);var blogControllers=angular.module("blogControllers",["blogServices"]);blogControllers.controller("loginCtrl",["$scope","$rootScope","$http","validator","$location",function(e,t,s,a,o){e.message="",e.messageClass="",e.account="",e.password="",e.login=function(){window.removeEventListener("beforeunload");var r=a.validateLogin({account:e.account,password:e.password});r?(e.messageClass="warning",e.message=r):s.post("/proxy/api/login",{account:e.account,password:e.password}).success(function(s){s.error?(e.messageClass="warning",e.message=s.message):(window.addEventListener("beforeunload",function(e){var t="Sure to leave?";return(e||window.event).returnValue=t,t}),e.messageClass="success",e.message="",t.userData=s.userData,s.userData.isManager?o.url("/home/page/1"):o.url("/user"))})}}]),blogControllers.controller("registerCtrl",["$scope","$http","validator",function(e,t,s){e.message="",e.messageClass="",e.account="",e.password="",e.again="",e.name="",e.register=function(){var a=s.validateRegister({account:e.account,password:e.password,name:e.name});e.password!==e.again&&(a+="两次输入密码不相同\n"),a?(e.messageClass="warning",e.message=a):t.post("/proxy/api/register",{account:e.account,password:e.password,name:e.name}).success(function(t){t.error?(e.messageClass="warning",e.message=t.message):(e.messageClass="success",e.message=t.message)})},e.superRegister=function(){var a=s.validateRegister({account:e.account,password:e.password,name:e.name});e.password!==e.again&&(a+="两次输入密码不相同\n"),a?(e.messageClass="warning",e.message=a):t.post("/proxy/Mapi/register",{account:e.account,password:e.password,name:e.name}).success(function(t){t.error?(e.messageClass="warning",e.message=t.message):(e.messageClass="success",e.message=t.message)})}}]),blogControllers.controller("userCtrl",["$scope","$http","validator","$rootScope","$location","$sce",function(e,t,s,a,o,r){a.userData||o.url("/login"),e.enterPostDetail=function(e){a.postData=e,o.url("/user/post/"+e._id)},e.title="",e.content="",e.message="",e.messageClass="",e.createPost=function(){console.log(e.message.length);var o=s.validatePost({title:e.title,content:e.content});o?(e.messageClass="warning",e.message=o):t.post("/proxy/api/post",{title:e.title,content:e.content}).success(function(t){t.error?(e.messageClass="warning",e.message=t.message):(e.messageClass="success",e.message="",a.userData.posts.unshift(t.postData),e.title="",e.content="")})}}]),blogControllers.controller("userPostDetailCtrl",["$scope","$http","validator","$rootScope","$location","$routeParams",function(e,t,s,a,o,r){a.userData||o.url("/login"),e.beforeTitle=a.postData.title,e.beforeContent=a.postData.content,e.content="",e.createComment=function(){var o=s.validateComment({content:e.content});o?(e.messageClass="warning",e.message=o):t.post("/proxy/api/post/"+r.postId+"/comment",{title:e.title,content:e.content}).success(function(t){t.error?(e.messageClass="warning",e.message=t.message):(e.messageClass="success",e.message="",a.postData.comments.push(t.commentData),e.content="")})},e.editState=!1,e.messageClass="",e.message="",e.editStateHandler=function(){e.editState=!e.editState,a.postData.title=e.beforeTitle,a.postData.content=e.beforeContent},e.editPost=function(){var o=s.validatePost({title:a.postData.title,content:a.postData.content});o?(e.anotherMessageClass="warning",e.anotherMessage=o):t.put("/proxy/api/post/"+r.postId,{title:e.postData.title,content:e.postData.content}).success(function(t){if(t.error)e.anotherMessageClass="warning",e.anotherMessage=t.message;else{e.anotherMessageClass="success",e.anotherMessage="",e.editState=!1,a.postData=t.postData,e.beforeTitle=a.postData.title,e.beforeContent=a.postData.content;var s=null;a.userData.posts.find(function(e,t){e._id==r.postId&&(s=t)}),null!=s&&(a.userData.posts.splice(s,1),a.userData.posts.unshift(t.postData))}})},e.deletePost=function(){window.confirm("Sure to delete the Post?")&&t["delete"]("/proxy/api/post/"+r.postId).success(function(t){if(t.error)e.messageClass="warning",e.message=t.message;else{e.messageClass="success",e.message="",e.editState=!1,a.postData=t.postData;var s=null;a.userData.posts.find(function(e,t){e._id==r.postId&&(s=t)}),null!=s&&a.userData.posts.splice(s,1),o.url("/user")}})}}]),blogControllers.controller("homeCtrl",["$scope","$http","validator","$rootScope","$location","$routeParams",function(e,t,s,a,o,r){a.userData||o.url("/login"),e.queryPosts=function(s){t.get("/proxy/api/posts?query="+s).success(function(t){if(t.error)alert(t.message);else{a.postsData=t.postsData,e.totalPosts=t.total,e.postsEachPage=t.eachPage,e.totalPages=Math.ceil(e.totalPosts/e.postsEachPage),e.pagesArray=[],e.currentPage=r.page,e.totalGroups=Math.ceil(e.totalPages/10),e.currentGroup=Math.ceil(e.currentPage/10),e.prePage=void 0,e.sufPage=void 0,e.currentGroup>1&&(e.prePage=10*(e.currentGroup-1)),e.currentGroup<e.totalGroups&&(e.sufPage=10*e.currentGroup+1);for(var s=10*(e.currentGroup-1)+1;s<=10*e.currentGroup&&s<=e.totalPages;s++)e.pagesArray.push(s)}})},e.queryPosts(r.page),e.enterPostDetail=function(e){a.postData=e,a.userData.isManager?o.url("/manager/post/"+e._id):o.url("/home/post/"+e._id)}}]),blogControllers.controller("homePostDetailCtrl",["$scope","$http","validator","$rootScope","$location","$routeParams",function(e,t,s,a,o,r){a.userData||o.url("/login"),e.content="",e.createComment=function(){var o=s.validateComment({content:e.content});o?(e.messageClass="warning",e.message=o):t.post("/proxy/api/post/"+r.postId+"/comment",{title:e.title,content:e.content}).success(function(t){t.error?(e.messageClass="warning",e.message=t.message):(e.messageClass="success",e.message="",a.postData.comments.push(t.commentData),e.content="")})}}]),blogControllers.controller("managerPostDetailCtrl",["$scope","$http","validator","$rootScope","$location","$routeParams",function(e,t,s,a,o,r){a.userData||o.url("/login"),e.postForbiddenSwitch=function(){t.put("/proxy/Mapi/post/"+r.postId).success(function(e){e.error?alert(e.message):(console.log(e),a.postData=e.postData)})},e.commentForbiddenSwitch=function(e){t.put("/proxy/Mapi/post/"+r.postId+"/comment/"+e).success(function(t){if(t.error)alert(t.message);else{var s=null;a.postData.comments.find(function(t,a){t._id===e&&(s=a)}),null!==s&&(a.postData.comments[s]=t.commentData)}})}}]),angular.module("phonecatFilters",[]).filter("checkmark",function(){return function(e){return e?"✓":"✘"}});var blogServices=angular.module("blogServices",["ngResource"]);blogServices.factory("Blog",["$resource",function(e){return e("api/post/:postId",{},{query:{method:"GET",params:{phoneId:"posts"},isArray:!0}})}]),blogServices.factory("validator",function(){var e={beChecked:{userAccount:{errorMessage:"用户名6~18位英文字母、数字",emptyMessage:"账号为空",pattern:/^[a-zA-Z0-9]{6,18}$/},userPassword:{errorMessage:"密码6~18位英文字母、数字",emptyMessage:"密码为空",pattern:/^[a-zA-Z0-9]{6,18}$/},userName:{errorMessage:"名字长度为2-20个字符",emptyMessage:"名字为空",pattern:/^.{2,20}$/},postTitle:{errorMessage:"blog标题长度为2-50个字符",emptyMessage:"blog标题为空",pattern:/^.{2,50}$/},postContent:{errorMessage:"blog内容长度为2-10000个字符",emptyMessage:"blog内容为空",pattern:/.{2,10000}/},commentContent:{errorMessage:"评论长度为2-2000个字符",emptyMessage:"评论内容为空",pattern:/.{2,2000}/}},_validate:function(e){var t="";for(var s in e)e[s]?this.beChecked[s].pattern.test(e[s])||(t+=this.beChecked[s].errorMessage+"\n"):t+=this.beChecked[s].emptyMessage+"\n";return t},validateRegister:function(e){return this._validate({userAccount:e.account,userPassword:e.password,userName:e.name})},validateLogin:function(e){return this._validate({userAccount:e.account,userPassword:e.password})},validatePost:function(e){return this._validate({postTitle:e.title,postContent:e.content})},validateComment:function(e){return this._validate({commentContent:e.content})}};return e});var validator={beChecked:{userAccount:{errorMessage:"用户名6~18位英文字母、数字",emptyMessage:"账号为空",pattern:/^[a-zA-Z0-9]{6,18}$/},userPassword:{errorMessage:"密码6~18位英文字母、数字",emptyMessage:"密码为空",pattern:/^[a-zA-Z0-9]{6,18}$/},userName:{errorMessage:"名字长度为2-20个字符",emptyMessage:"名字为空",pattern:/^.{2,20}$/},postTitle:{errorMessage:"blog标题长度为2-50个字符",emptyMessage:"blog标题为空",pattern:/^.{2,50}$/},postContent:{errorMessage:"blog内容长度为2-10000个字符",emptyMessage:"blog内容为空",pattern:/^.{2,10000}$/},commentContent:{errorMessage:"评论长度为2-2000个字符",emptyMessage:"评论内容为空",pattern:/^.{2,2000}$/}},_validate:function(e){var t="";for(var s in e)e[s]?this.beChecked[s].pattern.test(e[s])||(t+=this.beChecked[s].errorMessage+"\n"):t+=this.beChecked[s].emptyMessage+"\n";return t},validateRegister:function(e){return this._validate({userAccount:e.account,userPassword:e.password,userName:e.name})},validateLogin:function(e){return this._validate({userAccount:e.account,userPassword:e.password})},validatePost:function(e){return this._validate({postTitle:e.title,postContent:e.content})},validateComment:function(e){return this._validate({commentContent:e.content})}};module.exports=validator;